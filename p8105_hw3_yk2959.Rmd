---
title: "Homework 3 new"
author: "Kiran Kui"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(dplyr)
library(rnoaa)
library(hexbin)
library(patchwork)
library(packrat)
library(ggridges)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1

```{r}
#Loading the Instacart data
library(p8105.datasets)
data("instacart")

instacart

```

his dataset contains `r nrow(instacart)` rows and `r ncol(instacart)` columns, with each row resprenting a single product from an instacart order.

Variables include: 

* order id
* product id
* add to cart order
* reordered items
* user id
* evaluation set
* order number
* day of week that order was made
* hour of day that order was made
* days since last order
* product name 
* aisle id
* department id
* aisle 
* department

One of the key variables is the product name purchased at instacart: for instance, "shelled pistachios", "spring water". 

Another key variable is the aisle that the product was purchased: for instance, yoghurt, fresh vegetables, etc. 

In total, there are `r instacart %>% select(product_id) %>% distinct %>% count` products found in `r instacart %>% select(user_id, order_id) %>% distinct %>% count` orders from `r instacart %>% select(user_id) %>% distinct %>% count` distinct users.

```{r}
instacart %>% 
  count(aisle) %>% 
  arrange(desc(n))
```

I created a table summarizing the number of items ordered from aisle. In total, there are 134 aisles. 

```{r}
instacart %>% 
  count(aisle) %>% 
  filter(n > 10000) %>% 
  mutate(aisle = fct_reorder(aisle, n)) %>% 
  ggplot(aes(x = aisle, y = n)) + 
  geom_point() + 
  labs(title = "Number of items ordered in each aisle") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

```

I created a plot that shows the number of items ordered in each aisle. Here, aisles are ordered by ascending number of items.

```{r}
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>%
  group_by(aisle) %>% 
  count(product_name) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  filter(rank < 4) %>% 
  arrange(desc(n)) %>%
  knitr::kable()
```

The three most popular items in aisles `baking ingredients`, `dog food care`, and `packaged vegetables fruits`, and includes the number of times each item is ordered.

```{r}
instacart %>%
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>%
  group_by(product_name, order_dow) %>%
  summarize(mean_hour = mean(order_hour_of_day)) %>%
  spread(key = order_dow, value = mean_hour) %>%
  knitr::kable(digits = 2)
```
I created a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week.

# Problem 2

I read in, tidied and wrangled the dataset accel_data.csv

```{r}
# Load, tidy and wrangle the data
accel_df <- read_csv("./data/accel_data.csv") %>%
  janitor::clean_names() %>% 
  drop_na(day_id) %>% 
  pivot_longer( 
     cols = activity_1:activity_1440,
     names_to = "activity_minute",
     names_prefix = "activity_",
     values_to = "activity_amount") %>% 
  mutate(wkday_wkend = case_when(
        day == "Saturday" ~ "weekend",
        day == "Sunday" ~ "weekend",
        day == "Monday" ~ "weekday",
        day == "Tuesday" ~ "weekday",
        day == "Wednesday" ~ "weekday",
        day == "Thursday" ~ "weekday",
        day == "Friday" ~ "weekday",
        TRUE ~ ""),
        week = as.integer(week),
        day_id = as.integer(day_id), 
        activity_minute = as.numeric(activity_minute)) %>% 
  mutate(day=fct_relevel(day, "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

```

There are `r ncol(accel_df)` rows(observations) and `r nrow(accel_df)` columns variables in this dataset. This dataset describes the activity of a 63-year-old male with a BMI of 25, diagnosed with congestive heart failure at the Advanced Cardiac Care Center of Columbia University Medical Center. 

Each observation(row) aligns with a single activity of this individual. 

There are 6 variables `r colnames(accel_df)`corresponding to week, day ID, day of the week, activity minute, activity amount, and whether the activity was conducted on a weekday or a weekend, respectively.  

```{r}
# New table showing aggregation across minutes
accel_df_2 = accel_df %>% 
group_by(week, day) %>% 
  summarize(total_activity = sum(activity_amount)) %>% 
  pivot_wider(names_from = day,
              values_from = total_activity)
```

I aggregated across minutes to create a total activity variable for each day, and create a table showing these totals called accel_df_2. 

Some trends are apparent. My results show that physical activity was highest on Fridays with and lowest on Saturdays. 

```{r}
#Plot showing the 24-hour activity time courses for each day
ggplot(accel_df, aes(x=activity_minute, y=activity_amount, color=day)) + geom_point() +
  scale_x_continuous(breaks = c(120, 240, 360, 480, 600, 720, 840, 960,1080, 1200, 1320, 1440),
  limits = c(1, 1500)) + 
  labs(title = "Scatterplot showing the 24-hour activity time courses for each day",
    x = "Day",
    y = "Total Activity")

```

I made a single-panel scatterplot that shows the 24-hour activity time courses for each day and use color to indicate day of the week. 

The plot shows on the y-axis, the amount of physical activity, referring to the amount of activity that the individual performed in a specific minute. The x-axis is the activity number, refers to the specific minute that the physical activity was performed. Colors indicate the day of the week.

The scatterplot shows that between 0 to 300 minutes in the day (first 5h of the day between midnight and 5am), there was a low level of activity performed because the individual is likely still sleeping. Then, the level of physical activity increased and is at its peak between 360 minutes and 1320 minutes (between 6am and 10pm). The scatterplot shows that after 1380 minutes (11pm) in the day, the physical activity starts to decline again as the individual winds down for bedtime. 

Furthermore, peak physical activity levels occurs at different times on different days of the week. For instance, the peak physical activity levels on Sunday occurs around 600 minutes to 720 minutes, between 10am and 12pm. On the other hand, peak physical activity levels on Wednesday occurs between 1140 minutes and 1200 minutes, which is around 7pm and 8pm. This indicates that the individual has a different exercise schedule dependent on days of the week. 
